"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[9380],{36999:(j,f,u)=>{u.r(f),u.d(f,{GenerateBillsViewModel:()=>B});var T=u(10467),c=u(9120),a=u(31168),C=u(55028),O=u(46204),S=u(15082),V=u(9439),M=u(21050),g=u(1647),P=u(27329),d=u(40950),p=u(17924),y=u(94480),I=u(32668);class B extends O.g{get SelectAll(){return this._SelectAll}set SelectAll(e){e!=this._SelectAll&&(this._SelectAll=e,this.SelectUnselectAll(e))}get OnlyFirstInvs(){return this._OnlyFirstInvs}set OnlyFirstInvs(e){e!=this._OnlyFirstInvs&&(this._OnlyFirstInvs=e,this.FilterfirstInvs(e))}constructor(e){super(),this.InProgress="",this.ProgressMessage="",this.ProgressValue=0,this.ProgressWidth=0,this.ProgressMax=0,this.BasedOn=new S.y$(0),this.Status=new S.y$(0),this.Customer=new M.y$(0),this.From=new V.Dw(0),this.TO=new V.Dw(0),this.FromDate=new g.Lc(0),this.ToDate=new g.Lc(0),this.InvoiceDate=new g.Lc(0),this.TillDate=new g.Lc(0),this._SelectAll=!1,this.chkSelectAll=new y.c,this._OnlyFirstInvs=!1,this.chkOnlyFirstInvs=new y.c,this.VoucherWise=!1,this.DateWise=!1,this.rdoVoucherWise=new p.u("",0,"Doc"),this.rdoDateWise=new p.u("",0,"Doc"),this.dtpref=null,this.ShowProcessDialog=!1,this.VirtualVouchersTable=[],this.DisplayName=e,this.FromDate.Label=c.d.GetResource("DocumentDesigner_FromDate"),this.Customer.Label="Customer",this.Customer.CCID=2,this.Customer.TypeID=2,this.ToDate.Label=c.d.GetResource("DocumentDesigner_ToDate"),this.BasedOn.Label="Post Bills",this.Status.Label="Show Contracts",this.BasedOn.Items.push(S._p.ComboBoxItems_2("Contract based","0")),this.BasedOn.Items.push(S._p.ComboBoxItems_2("Customer based","1")),this.Status.Items.push(S._p.ComboBoxItems_2("Both","0")),this.Status.Items.push(S._p.ComboBoxItems_2("Pending","1")),this.Status.Items.push(S._p.ComboBoxItems_2("Invoiced","2")),this.BasedOn.SelectedValue="0",this.Status.SelectedValue="1",this.InvoiceDate.Label="Invoice Date",this.VoucherWise=!1,this.DateWise=!0,this.From.Label="From",this.TO.Label="To",this.TillDate.Label="Till Date",this.LoadGrid(),this.rdoVoucherWise.Label=c.d.GetResource("Com_HCNoWise"),this.rdoVoucherWise.CheckedChangedCommand.Subscribe(this,"onVoucherWiseCheck"),this.rdoDateWise.Label=c.d.GetResource("Com_DateWise"),this.rdoDateWise.CheckedChangedCommand.Subscribe(this,"onDateWiseCheck"),this.chkSelectAll.Label=c.d.GetResource("Selectall"),this.chkSelectAll.CheckedChangedCommand.Subscribe(this,"onSelectall"),this.chkOnlyFirstInvs.Label=c.d.GetResource("OnlyFirst"),this.chkOnlyFirstInvs.CheckedChangedCommand.Subscribe(this,"onOnlyFirstInvs"),this.ProgressWidth=1}onSelectall(e){this.SelectAll=e.IsChecked}onOnlyFirstInvs(e){this.OnlyFirstInvs=e.IsChecked}onVoucherWiseCheck(e){this.VoucherWise=e.IsChecked,this.DateWise=!1,this.rdoDateWise.IsChecked=!1,this.FromDate.Enable=!1,this.ToDate.Enable=!1,this.From.Enable=!0,this.TO.Enable=!0}onDateWiseCheck(e){this.DateWise=e.IsChecked,this.VoucherWise=!1,this.rdoVoucherWise.IsChecked=!1,this.FromDate.Enable=!0,this.ToDate.Enable=!0,this.From.Enable=!1,this.TO.Enable=!1}OnBeginEdit(e){return!a.J0.IsEmpty(e.args.item.BillNo)}LoadGrid(){this.Vouchers=new P.vv(!0),this.Vouchers.CanUserDeleteRows=!0,this.Vouchers.Table=[],this.Vouchers.OnBeginEdit.Subscribe(this,"OnBeginEdit"),this.Vouchers.TableColumns.push("Select"),this.Vouchers.TableColumns.push("Sno"),this.Vouchers.TableColumns.push("Date"),this.Vouchers.TableColumns.push("HCNo"),this.Vouchers.TableColumns.push("Customer"),this.Vouchers.TableColumns.push("Product"),this.Vouchers.TableColumns.push("BillCycle"),this.Vouchers.TableColumns.push("Price"),this.Vouchers.TableColumns.push("CustomerID"),this.Vouchers.TableColumns.push("DtBill"),this.Vouchers.TableColumns.push("BillNo"),this.Vouchers.TableColumns.push("Billdate"),this.Vouchers.TableColumns.push("TotDays"),this.Vouchers.TableColumns.push("InvDocDetailsID"),this.Vouchers.TableColumns.push("Remarks"),this.Vouchers.TableColumns.push("ProductID"),this.Vouchers.TableColumns.push("Fromdate"),this.Vouchers.TableColumns.push("Todate"),this.Vouchers.TableColumns.push("billseq"),this.Vouchers.TableColumns.push("serialno"),this.Vouchers.TableColumns.push("srnos");let e=new d.O7;this.Vouchers.Columns=[],e=new d.O7,e.Header="Select",e.DisplayMember="Select",e.DataType="CheckBox",e.Width=50,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Sno",e.DisplayMember="Sno",e.DataType="TextBlock",e.Width=50,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="HC Date",e.DisplayMember="Date",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="HC No.",e.DisplayMember="HCNo",e.DataType="LINK",e.Click.Subscribe(this,"onHCClick"),e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Customer",e.DisplayMember="Customer",e.DataType="TextBlock",e.Width=200,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Product",e.DisplayMember="Product",e.DataType="TextBlock",e.Width=150,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="BillCycle",e.DisplayMember="BillCycle",e.DataType="TextBlock",e.Width=200,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Tot Days",e.DisplayMember="TotDays",e.DataType="TextBlock",e.Width=80,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Qty",e.DisplayMember="Qty",e.DataType="FLOAT",e.Width=80,e.ReadOnly=!0,e.IsVisible=!1,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Price",e.DisplayMember="Price",e.DataType="FLOAT",e.Width=70,e.DecimalPoints=c.d.SessionManager.Preferences.DecimalsinAmount,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Bill No",e.DisplayMember="BillNo",e.DataType="LINK",e.Width=100,e.ReadOnly=!0,e.Click.Subscribe(this,"onDOcClick"),this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Bill Date",e.DisplayMember="Billdate",e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),e=new d.O7,e.Header="Remarks",e.DisplayMember="Remarks",e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e);try{let h=[],n=c.d.common.GetDataSet("GB001","");if(null!=n&&n.Tables.length>0&&n.Tables[0].length>0&&n.Columns[1].Contains("SysColumnName")){let t=n.Tables[0].filter(o=>"GBFields"==o.Name);if(t.length>0&&""!=t[0].Value.ToString()&&(h=t[0].Value.toString().split(";"),null!=h&&h.length>0))for(let o=0;o<n.Tables[1].length;o++)for(let i=0;i<h.length;i++)h[i]==n.Tables[1][o].SysColumnName.toString()&&(e=new d.O7,e.Header=n.Tables[1][o].ResourceData.toString(),e.DisplayMember=n.Tables[1][o].SysColumnName.toString(),e.Width=100,e.ReadOnly=!0,this.Vouchers.Columns.push(e),this.Vouchers.TableColumns.Contains(n.Tables[1][o].SysColumnName.toString())||this.Vouchers.TableColumns.push(n.Tables[1][o].SysColumnName.toString()))}}catch{}this.Vouchers.SearchVisible=!0,this.Vouchers.SelectAll.Visible=!0,this.Vouchers.SearchColStartIndex=1,this.Vouchers.AddSearchCols()}onHCClick(e){var h=this;return(0,T.A)(function*(){if(null!=h.Vouchers.SelectedItem&&!a.J0.IsEmpty(h.Vouchers.SelectedItem.HCNo)){let n=0,t=c.d.report.GetDocumentDetailsByVoucherNo(h.Vouchers.SelectedItem.HCNo.toString());if(n=a.J0.Int(t.obj),n>0){let o;o=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0];const{AddEditDocumentComponent:i}=yield Promise.resolve().then(u.bind(u,19214)),{AddEditDocumentViewModel:s}=yield Promise.resolve().then(u.bind(u,32668));let l=new s(parseInt(o.CostCenterID),o.DocumentName.toString(),!0);l.ScreenObject.DocPrefix.ComboBox.SelectedValue=o.DocPrefix.toString(),l.ScreenObject.DocPrefix.TextBox.Text=o.DocNumber.toString(),l.OnDocPrefixChanged("lostFocus"),l.ScreenObject.FillDocumentPrefix(!0),c.d.page.addNewTab({component:i,params:{obj:l}})}}})()}onDOcClick(e){var h=this;return(0,T.A)(function*(){if(null!=h.Vouchers.SelectedItem&&!a.J0.IsEmpty(h.Vouchers.SelectedItem.BillNo)){let n=0,t=c.d.report.GetDocumentDetailsByVoucherNo(h.Vouchers.SelectedItem.BillNo.toString());if(n=a.J0.Int(t.obj),n>0){let o;o=t.Tables[0].length>0?t.Tables[0][0]:t.Tables[1][0];const{AddEditDocumentComponent:i}=yield Promise.resolve().then(u.bind(u,19214));let s=new I.AddEditDocumentViewModel(parseInt(o.CostCenterID),o.DocumentName.toString(),!0);s.ScreenObject.DocPrefix.ComboBox.SelectedValue=o.DocPrefix.toString(),s.ScreenObject.DocPrefix.TextBox.Text=o.DocNumber.toString(),s.OnDocPrefixChanged("lostFocus"),s.ScreenObject.FillDocumentPrefix(!0),c.d.page.addNewTab({component:i,params:{obj:s}})}}})()}OnButtonClick(e){if("Hide"==e)this.ShowProcessDialog=!1;else if("Generate Bills"==e)this.ProgressMessage="Resaving documents.Please wait...",this.ShowProcessDialog=!0,this.SaveCall();else if("Export"!=e&&"OK"==e){this.SelectAll=!1;let h=0,n=0;null!=this.From.Text&&a.J0.Int(this.From.Text)>0&&(h=parseInt(this.From.Text)),null!=this.TO.Text&&a.J0.Int(this.TO.Text)>0&&(n=parseInt(this.TO.Text));let o,t=this.GetBills(this.FromDate.Date,this.ToDate.Date,this.VoucherWise,h,n,this.TillDate.Date,this.Customer.SelectedValue);if(null!=t&&t.Tables.length>0&&t.Columns[0].Contains("ErrorMessage")&&t.Tables[0].length>0)return this.DisplayMessage=t.Tables[0][0].ErrorMessage.toString(),void(this.MessageVisibility=!0);if(null!=t&&t.Tables.length>0){let i=!1;if(t.Tables.length>1&&t.Tables[1].length>0&&t.Columns[1].Contains("Name")){this.dtpref=t.Tables[1];let s=this.dtpref.filter(D=>"GBFields"==D.Name);if(s.length>0&&""!=s[0].Value.ToString()&&(o=s[0].Value.toString().split(";")),!this.Vouchers.TableColumns.Contains("Qty")){let D=this.dtpref.filter(r=>"QtyBased"==r.Name);D.length>0&&!a.J0.IsEmpty(D[0].Value)&&(0,C.yG0)(D[0].Value.toString())&&(this.Vouchers.TableColumns.push("Qty"),this.Vouchers.Columns[8].IsVisible=!0,this.Vouchers.UpdateFooter())}let l=this.dtpref.filter(D=>"InvoiceOnDelDate"==D.Name);l.length>0&&(i=(0,C.yG0)(l[0].Value.toString())),i&&!this.Vouchers.TableColumns.Contains("InvDate")&&this.Vouchers.TableColumns.push("InvDate")}this.Vouchers.Table.Clear();for(let s=0;s<t.Tables[0].length;s++){if("1"==this.Status.SelectedValue&&!a.J0.IsEmpty(t.Tables[0][s].BillNo)||"2"==this.Status.SelectedValue&&""==a.J0.String(t.Tables[0][s].BillNo))continue;let l=this.Vouchers.NewRow();l.Date=a.J0.ParseDate(t.Tables[0][s].docdate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"]),l.HCNo=t.Tables[0][s].voucherno,l.Customer=t.Tables[0][s].accountname,l.CustomerID=t.Tables[0][s].debitaccount,l.Product=t.Tables[0][s].productname,l.ProductID=t.Tables[0][s].Prodid,l.Fromdate=a.J0.ParseDate(a.J0.String(t.Tables[0][s].Fromdate)),l.Todate=a.J0.ParseDate(a.J0.String(t.Tables[0][s].Todate)),l.BillCycle="from "+a.J0.ParseDate(t.Tables[0][s].Fromdate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"])+"- to "+a.J0.ParseDate(t.Tables[0][s].Todate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"]),a.J0.IsEmpty(t.Tables[0][s].Amount)||(l.Price=parseFloat(t.Tables[0][s].Amount.toString()).ToString("N"+c.d.SessionManager.Preferences.DecimalsinAmount));let r=a.J0.ParseDate(t.Tables[0][s].Todate.toString()).Subtract(a.J0.ParseDate(t.Tables[0][s].Fromdate.toString())).TotalDays+1;a.J0.IsEmpty(t.Tables[0][s].ExlDays)||(r-=parseInt(t.Tables[0][s].ExlDays.toString())),l.TotDays=r,l.DtBill=a.J0.ParseDate(t.Tables[0][s].Billdate.toString()),l.Billdate=a.J0.ParseDate(t.Tables[0][s].Billdate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"]),l.BillNo=t.Tables[0][s].BillNo,l.InvDocDetailsID=t.Tables[0][s].InvDocDetailsID,l.Sno=(s+1).toString(),l.Select=!1,this.Vouchers.TableColumns.Contains("Qty")&&t.Columns[0].Contains("Qty")&&(l.Qty=t.Tables[0][s].Qty),this.Vouchers.TableColumns.Contains("billseq")&&t.Columns[0].Contains("billseq")&&(l.billseq=t.Tables[0][s].billseq),i&&(l.InvDate="1"==l.billseq.toString()?a.J0.ParseDate(a.J0.String(t.Tables[0][s].Fromdate)):a.J0.ParseDate(a.J0.String(t.Tables[0][s].Todate)));let m=this.dtpref.filter(b=>"OffHireDoc"==b.Name);if(m.length>0&&!a.J0.IsEmpty(m[0].Value)&&parseInt(m[0].Value.toString())>0&&(l.Remarks=t.Columns[0].Contains("isoffhire")&&!a.J0.IsEmpty(t.Tables[0][s].isoffhire)&&(0,C.yG0)(t.Tables[0][s].isoffhire.toString())?"Off Hire":"Hire cont."),null!=o&&o.length>0)for(let b=0;b<o.length;b++)t.Columns[0].Contains(o[b])&&!a.J0.IsEmpty(t.Tables[0][s][o[b]])&&(l[o[b]]=t.Tables[0][s][o[b]].toString());this.GetSerNo(t,t.Tables[0][s],l),this.Vouchers.addRow(l)}this.VirtualVouchersTable=this.Vouchers.Table,this.FilterfirstInvs(this.OnlyFirstInvs)}}}GetSerNo(e,h,n){if(e.Tables.length>2&&e.Tables[2].length>0&&e.Columns[2].Contains("SerialNumber")){let t=null;if(""!=h.retid.toString()){t=e.Tables[2].filter(o=>o.InvDocDetailsID==h.retid.toString());for(let o=0;o<t.length;o++){let i=e.Tables[2].filter(s=>s.InvDocDetailsID==h.tempid.toString()&&s.SerialNumber==t[o].SerialNumber.toString());i.length>0&&e.Tables[2].Remove(i[0])}}if(t=e.Tables[2].filter(o=>o.InvDocDetailsID==h.tempid.toString()),t.length>0){let o="",i="";i+="<xml>";for(let s=0;s<t.length;s++)i+="<Row ",i+=' SerialProductID="0" ',i+=' SerialNumber="'+t[s].SerialNumber.toString()+'" ',i+=' StockCode="'+t[s].StockCode.toString()+'" ',i+=' Quantity="0" ',i+=' Narration="" ',i+=' IsIssue="1" ',i+=' StatusID="158" ',i+=' RefInvDocDetailsID="'+t[s].RefInvDocDetailsID.toString()+'" ',i+=' IsAvailable="0" ',i+=' SerialGUID="'+t[s].SerialGUID.toString()+'" ',i+=" ></Row>",""!=o&&(o+=","),o+=t[s].SerialNumber.toString();i+="</xml>",n.serialno=i.toString(),n.srnos=o}}}GetExportHTML(){let e="",h="";e+="<html><meta charset='utf-8' /><body style='color:blac;background-color:white;'>",h+=".hdr{text-align:cente; padding:5px; background-color:#4F81BD;color:white;font-family:Arial;font-size:11pt} ",h+=".grp{padding:2p; background-color:#87CEEB; color:#FFFCF7;font-family:arial; font-size:10pt;}",h+=".tot{background-color:whit; color:red;font-family:arial; font-weight:bold; font-size:8pt;}",h+=".alt{background-color:whitesmok; color:black; font-family:arial; font-size:9pt; align:right;}",e+="<style>"+h.toString()+"</style>";let t=0;for(let i=0;i<this.Vouchers.Columns.length;i++)t+=this.Vouchers.Columns[i].Width;e+="<table>",e+="\r\n<tr><td align='center'><h2>",e+=c.d.SessionManager.CompanyName,e+="</h2></td></tr>",e+="\r\n<tr><td align='center'><h3 style='vertical-align:middl;'>",e+=this.DisplayName,e+="</h3></td></tr>",e+="\r\n<tr><td align='center'>",e+=" From :  "+this.FromDate.Date.ToString(c.d.SessionManager.Preferences["Date Format"]),e+=" &nbs;&nbsp;&nbsp;To :  "+this.ToDate.Date.ToString(c.d.SessionManager.Preferences["Date Format"]),e+="</td></tr>",e+="<tr><td style='padding-top:10p;'><table border=1 width='"+t+"' style='border-collapse:collapse;  font-family:arial; font-size:9pt;' >",e+="<COLGROUP>";for(let i=0;i<this.Vouchers.Columns.length-2;i++)e+="FLOAT"==this.Vouchers.Columns[i].DataType?"<COL style='text-align:righ;'>":"<COL style=''>";e+="</COLGROUP>",e+="<tr style=''>";for(let i=0;i<this.Vouchers.Columns.length-2;i++)e+="<th class='hdr' width='"+this.Vouchers.Columns[i].Width,e+="px' >",e+=this.Vouchers.Columns[i].Header,e+="</th>";e+="</tr>";let o=this.Vouchers.Table;for(let i=0;i<o.length;i++){e+="<tr",i%2==1&&(e+=" class=alt"),e+=">";for(let s=0;s<this.Vouchers.Columns.length-2;s++)e+="<td",e+="FLOAT"==this.Vouchers.Columns[s].DataType?" align='right'":" align='left'",e+=">",e+=o[i][this.Vouchers.Columns[s].DisplayMember].toString(),e+="</td>";e+="</tr>"}return e+="</table>",e+="</td></tr></table>",e+="</body><html>",e}SelectUnselectAll(e){let h=this.Vouchers.Table;for(let n=0;n<h.length;n++)""==a.J0.String(h[n].BillNo)&&(h[n].Select=e);this.Vouchers.refreshDataView()}FilterfirstInvs(e){this.Vouchers.TableColumns.Contains("billseq")&&(this.Vouchers.Table=e?this.VirtualVouchersTable.filter(h=>1==h.billseq):this.VirtualVouchersTable)}SaveCall(){if(this.ProgressValue=1,null==this.dtpref)return;let e=0,h=0,n=!1;this.Billdatefld="";let t=this.dtpref.filter(r=>"SIVDoc"==r.Name);if(t.length>0&&(e=parseInt(t[0].Value.toString())),t=this.dtpref.filter(r=>"HireContractDoc"==r.Name),t.length>0&&(h=parseInt(t[0].Value.toString())),t=this.dtpref.filter(r=>"SIVBillingDate"==r.Name),t.length>0&&(this.Billdatefld=t[0].Value.toString()),t=this.dtpref.filter(r=>"InvoiceOnDelDate"==r.Name),t.length>0&&(n=(0,C.yG0)(t[0].Value.toString())),0==e)return;this.objViewModel=new I.AddEditDocumentViewModel(e,"",!0),this.objViewModel.GenratePrefix=!0;var o=this.objViewModel.ScreenObject.Link.LinkCombo.Items.find(r=>r.Parent==h.toString());if(null==o||null==o)return void(this.DisplayMessage="Please place linking between Hire Contract and Sales invoice Docuemnt");if(this.objViewModel.ScreenObject.Link.LinkCombo.SelectedValue=o.Value,!this.objViewModel.ScreenObject.GridDataColumns.Contains(this.Billdatefld))return void(this.DisplayMessage="Sales invoice Billing Date should be in body");let i="",s=null;"1"==this.BasedOn.SelectedValue?n?(s=this.Vouchers.Table.filter(r=>1==r.Select),s=s.sort((r,m)=>r.CustomerID>m.CustomerID||r.CustomerID==m.CustomerID&&r.InvDate>m.InvDate?1:-1)):(s=this.Vouchers.Table.filter(r=>1==r.Select),s=s.sort((r,m)=>m.CustomerID-r.CustomerID)):n?(s=this.Vouchers.Table.filter(r=>1==r.Select),s=s.sort((r,m)=>r.HCNo>m.HCNo||r.HCNo==m.HCNo&&r.InvDate>m.InvDate?1:-1)):(s=this.Vouchers.Table.filter(r=>1==r.Select),s=s.sort((r,m)=>m.HCNo-r.HCNo)),this.obja=[];let l=null,D=[];for(let r=0;r<s.length;r++)D.Contains(s[r].HCNo.toString())||D.push(s[r].HCNo),(0==r||n&&a.J0.ParseDate(s[r].InvDate.toString()).Date()!=a.J0.ParseDate(s[r-1].InvDate.toString()).Date()||"1"==this.BasedOn.SelectedValue&&a.J0.String(s[r].CustomerID)!=a.J0.String(s[r-1].CustomerID)||"1"!=this.BasedOn.SelectedValue&&a.J0.String(s[r].HCNo)!=a.J0.String(s[r-1].HCNo))&&(r>0&&this.obja.push(l),l=[]),l.push(s[r]);null!=l&&this.obja.push(l);for(let r=0;r<D.length;r++)""!=i&&(i+="','"),i+=D[r].toString();this.ProgressMax=this.obja.length,this.InProgress=this.ProgressValue+" of "+this.ProgressMax,this.ProgressWidth=100*(this.ProgressValue-1)/this.ProgressMax,0==this.ProgressWidth&&(this.ProgressWidth=1),this.objViewModel.ScreenObject.GetLinkDocDetails(i,parseInt(o.Value),"",!0).subscribe(r=>{this.dsLink=r,this.objViewModel.IsSelectAll=!0,this.iLoop=0,this.objViewModel.SaveCallBackMethod.Subscribe(this,"SaveCallBack_Complete"),this.SaveCallBack()})}SaveCallBack(){let e=!1,h=this.dtpref.filter(t=>"InvoiceOnDelDate"==t.Name);if(h.length>0&&(e=(0,C.yG0)(h[0].Value.toString())),this.iLoop>=this.obja.length)return this.Vouchers.refreshDataView(),void(this.ShowProcessDialog=!1);this.InProgress=this.ProgressValue+" of "+this.ProgressMax,this.ids=this.obja[this.iLoop],this.objViewModel.DocumentDate=this.InvoiceDate.Date,this.objViewModel.DocumentDate=e&&this.ids.length>0?a.J0.ParseDate(this.ids[0].InvDate).Date():this.InvoiceDate.Date;for(let t=0;t<this.ids.length;t++){let o=[];o.push(this.ids[t]),0==t&&null!=this.objViewModel.ScreenObject.DebitAccount&&(this.objViewModel.ScreenObject.DebitAccount.SelectedValue=parseInt(a.J0.String(this.ids[t].CustomerID)),this.objViewModel.ScreenObject.Data.Tables[0].filter(l=>null!=l.LocalReference&&l.LocalReference=="'"+this.objViewModel.ScreenObject.DebitAccount.DBColumnID+"'").length>0&&this.objViewModel.ScreenObject.GetLinkReferenceData(this.objViewModel.ScreenObject.DebitAccount.DBColumnID,this.objViewModel.CostCenterID,this.objViewModel.ScreenObject.DebitAccount.SelectedValue,this.objViewModel.DocumentDate,this.objViewModel.ScreenObject.DebitAccount.DBColumnName,2,null));let i=this.objViewModel.GetEmptyRowPosition(this.objViewModel.ScreenObject.GridDataObj,"ProductID_Key");if(this.objViewModel.LoadLinkData(this.dsLink,o,0,[],null),this.objViewModel.ScreenObject.GridData[i][this.Billdatefld]=a.J0.ParseDate(this.ids[t].DtBill.toString()).ToString(c.d.SessionManager.Preferences["Date Format"]),this.objViewModel.ScreenObject.GridDataColumns.Contains(this.Billdatefld+"_Key")&&(this.objViewModel.ScreenObject.GridData[i][this.Billdatefld+"_Key"]=a.J0.ParseDate(this.ids[t].DtBill.toString())),this.objViewModel.ScreenObject.GridDataColumns.Contains("dcnum10")&&(this.objViewModel.ScreenObject.GridData[i].dcnum10=this.ids[t].TotDays.toString()),!a.J0.IsEmpty(this.ids[t].Fromdate)&&this.objViewModel.ScreenObject.GridDataColumns.Contains("dcalpha6_Key")&&(this.objViewModel.ScreenObject.GridData[i].dcalpha6_Key=a.J0.ParseDate(this.ids[t].Fromdate.toString()),this.objViewModel.ScreenObject.GridData[i].dcalpha6=a.J0.ParseDate(this.ids[t].Fromdate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"])),!a.J0.IsEmpty(this.ids[t].Todate)&&this.objViewModel.ScreenObject.GridDataColumns.Contains("dcalpha7_Key")&&(this.objViewModel.ScreenObject.GridData[i].dcalpha7_Key=a.J0.ParseDate(this.ids[t].Todate.toString()),this.objViewModel.ScreenObject.GridData[i].dcalpha7=a.J0.ParseDate(this.ids[t].Todate.toString()).ToString(c.d.SessionManager.Preferences["Date Format"])),this.objViewModel.ScreenObject.GridData[i].ProductID_Key.toString()!=this.ids[t].ProductID.toString()&&(this.objViewModel.ScreenObject.GridData[i].ProductID_Key=this.ids[t].ProductID.toString()),this.objViewModel.ScreenObject.GridData[i].Rate=this.ids[t].Price.toString(),this.Vouchers.TableColumns.Contains("Qty")&&!a.J0.IsEmpty(this.ids[t].Qty)&&(this.objViewModel.ScreenObject.GridData[i].Quantity=this.ids[t].Qty.toString()),this.objViewModel.ScreenObject.GridDataColumns.Contains("LineNarration")&&(this.objViewModel.ScreenObject.GridData[i].LineNarration=this.ids[t].BillCycle.toString()+"("+this.ids[t].Remarks.toString()+")"),""!=this.ids[t].serialno.toString()&&"2"==this.objViewModel.ScreenObject.GridData[i].Type.toString()){this.objViewModel.ScreenObject.GridData[i].ExtraXML=this.ids[t].serialno.toString();var n=this.objViewModel.ScreenObject.Data.Tables[0].filter(s=>79==s.LocalReference&&54308==s.LinkData);n.length>0&&n.length>0&&this.objViewModel.ScreenObject.GridDataColumns.Contains(n[0].SysColumnName.toString())&&(this.objViewModel.ScreenObject.GridData[i][n[0].SysColumnName.toString()]=this.ids[t].srnos.toString())}this.objViewModel.CalculateTotals(this.objViewModel.ScreenObject.GridData[i],!1)}this.objViewModel.SaveInventoryDocument("Save",!1)}SaveCallBack_Complete(){setTimeout(()=>{if(this.objViewModel.RetValue<=0)this.objViewModel.clear(1);else for(let e=0;e<this.ids.length;e++)this.ids[e].BillNo=this.objViewModel.DisplayMessage,this.ids[e].Select=!1;this.ProgressValue++,this.iLoop++,this.SaveCallBack()},30)}GetBills(e,h,n,t,o,i,s){Logger.InfoLog("Document:: Inside GetBills");try{let l=[];return l.push(e.ToString("dd/MMM/yyyy")),l.push(h.ToString("dd/MMM/yyyy")),l.push(n),l.push(t),l.push(o),l.push(i.ToString("dd/MMM/yyyy")),l.push(s),l.push(c.d.SessionManager.UserName),l.push(c.d.SessionManager.UserID),l.push(c.d.SessionManager.LanguageID),c.d.document.GetBills(l)}catch(l){return Logger.ErrorLog("Document:: GetBills"+l.stack),null}}}}}]);