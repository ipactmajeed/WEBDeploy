"use strict";(self.webpackChunkRevenUWebApp=self.webpackChunkRevenUWebApp||[]).push([[1759],{4140:(k,j,D)=>{D.r(j),D.d(j,{DashBoardNotifViewModel:()=>F});var V=D(10467),a=D(9120),s=D(31168),_=D(46204),W=D(27329),A=D(58111),x=D(40950),w=D(72669),v=D(9439),R=D(36447),U=D(28923);class F extends _.g{constructor(t){super(),this.ProgressValue=0,this.ProgressMax=0,this.ShowProcessDialog=!1,this.LocationID="",this.dtColumns=[],this.EventsType=0,this.Enable=!0,this.ClubInvoice=!1,this.oDocument=null,this._BulkDr=null,this._Ddate=Date.Today();try{this.EventsType=t,this.Grid=new W.vv,this.Grid.Width="500",this.Grid.OnLinkClick.Subscribe(this,"OnLinkClickEvent"),this.InitColumns(),2==t&&this.RefreshData()}catch(l){Logger.ErrorLog("DashBoardNotifViewModel","Constructor",l)}Logger.InfoLog("DashBoardNotifViewModel:: Entering DashBoardNotifViewModel")}InitColumns(){2==this.EventsType?this.Grid.Columns=A.GeneralDashboardViewModel.InitColumns("Notification Events_DashBoardCustomize"):4==this.EventsType&&(this.Grid.Columns=A.GeneralDashboardViewModel.InitColumns("Post Dated Documents_DashBoardCustomize"),this.LocationID=a.d.SessionManager.Preferences.ContainsKey("EnableLocationWise")&&"True"==a.d.SessionManager.Preferences.EnableLocationWise.toString()?a.d.SessionManager.LocationID>0?a.d.SessionManager.LocationID.toString():a.d.SessionManager.LocationWhere:"0",a.d.SessionManager.IsActionAssigned(4e4,"Read")&&(R.PostedDocumentViewModel.SetDimensionQuery(),a.d.document.GetDashPDCDocuments(this.LocationID,R.PostedDocumentViewModel.strSelect,R.PostedDocumentViewModel.strJoin).subscribe(t=>{this.dt=t.Tables[0],null!=this.dt&&this.dt.forEach(l=>{l.id=a.d.slick.rowid,l.Date_Text=s.J0.ParseDate(l.DocDate).ToString(a.d.SessionManager.Preferences["Date Format"]),null!=l.ChequeMaturityDate&&(l.MaturityDate=s.J0.ParseDate(l.ChequeMaturityDate).ToString(a.d.SessionManager.Preferences["Date Format"]))}),this.Grid.Table=this.dt})))}RefreshData(){if(2==this.EventsType){let t="";"True"==a.d.SessionManager.Preferences.EnableLocationWise.toString()&&"True"==a.d.SessionManager.Preferences["LW Reports"]&&(a.d.SessionManager.LocationID>0?t=" and dcc.dcCCNID2="+a.d.SessionManager.LocationID:"1"!=a.d.SessionManager.RoleID&&!s.J0.IsEmpty(a.d.SessionManager.LocationWhere)&&(t=" and dcc.dcCCNID2 IN ("+a.d.SessionManager.LocationWhere+")")),U.$.GetScheduleEvents(t).subscribe(l=>{let m=l.Tables[0],i=!1;if(null!=m){let b,e=0;m.forEach(h=>{h.id=a.d.slick.rowid,b=s.J0.ParseDate(h.EventTime),(29==b.Minute||59==b.Minute)&&(b=b.AddMinutes(1)),h.EventTime_Text=b.ToString(a.d.SessionManager.Preferences["Date Format"]+" hh:mm a"),e=parseInt(h.FreqType),1==e?h.FreqType=a.d.GetResource("Com_Once"):4==e?h.FreqType=a.d.GetResource("Reports_LblDaily"):8==e?h.FreqType=a.d.GetResource("Com_Weekly"):16==e||32==e?h.FreqType=a.d.GetResource("Com_Monthly"):0==e&&(h.FreqType="Contract"),s.J0.Int(h.TrackingNO)>0&&(i=!0)})}if(i&&!this.Grid.Columns.find(e=>"TrackingNO"==e.DisplayMember)){let e=new x.O7;e.Header="TrackingNO",e.DisplayMember="TrackingNO",e.ReadOnly=!0,e.Width=80,this.Grid.Columns.push(e),this.Grid.RefreshColumns()}this.Grid.Table=m})}}OnButtonClick(t){"PostPDC"==t||"RefreshPDC"==t&&this.RefreshData()}OnLinkClickEvent(t,l,m){try{4==this.EventsType?w.RibbonExtViewModel.LoadDocument(t):2==this.EventsType&&this.LoadDocument(t,!1)}catch(i){Logger.ErrorLog("UnAppDocumentsViewModel","OnLinkClickEvent",i)}}AutoPost(){var t=this;return(0,V.A)(function*(){const{ProcessDialogViewModel:l}=yield D.e(9449).then(D.bind(D,79449)),{ProcessDialogComponent:m}=yield D.e(2893).then(D.bind(D,82893));t.ProgressMessage="Resaving documents.Please wait...";let i=new l(t);a.d.page.ShowDialog(i,m,{HideClose:!1,HideHeader:!0,ShowCenter:!0})})()}save(){this.ProgressMessage="Posting documents please wait..";let t=null;this.ClubInvoice?(t=this.dt.filter(i=>1==i.Select),t.sort((i,e)=>i.contractID-e.contractID)):t=this.dt.filter(i=>1==i.Select),this.ProgressMax=t.length,this.ProgressValue=0,this.ShowProcessDialog=!0;let l=new Array,m=0;for(let i=0;i<t.length;i++){if(null!=this.oDocument&&m>0&&this.ClubInvoice&&!s.J0.IsEmpty(t[i].contractID)&&m!=parseInt(t[i].contractID.toString())&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),l.forEach(e=>{e.Remarks=this.oDocument.DisplayMessage,e.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo}),l.Clear()),m=parseInt(t[i].contractID),""==s.J0.String(t[i].Postedvoucherno)&&(this.ClubInvoice?setTimeout(()=>{this.LoadDocument(t[i],!0,!1,l.length),l.push(t[i])},100):setTimeout(()=>{this.LoadDocument(t[i],!0)},100),null==this.oDocument))return void(t[i].Remarks="Define particulars dimension in body");t[i].Select=!1,this._BulkDr=t[i][i]}null!=this.oDocument&&l.length>0&&(this.oDocument.GenratePrefix=!0,this.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?this.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":this.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),this.oDocument.SaveInventoryDocument("ReSave"),l.forEach(i=>{i.Remarks=this.oDocument.DisplayMessage,i.Postedvoucherno=this.oDocument.ScreenObject.VoucherNo})),this.ProgressMax==this.ProgressValue&&(this.ShowProcessDialog=!1)}GetNarr(t,l,m){let i="";if(null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!s.J0.IsEmpty(t.Tables[0][0].RentNodeid)){var e=t.Tables[1].filter(b=>b.PartID==t.Tables[0][0].RentNodeid.toString());e.length>0&&!s.J0.IsEmpty(e[0].cnt)&&(i+=this.GetStr(e[0].cnt.toString(),m)+"Installment")}return i+=" for the Period of (",a.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=a.d.SessionManager.Preferences.RentalNarrFormat?i+=l.ToString(a.d.SessionManager.Preferences.RentalNarrFormat):i+=l.ToString("MMM/yyyy"),null!=t&&t.Tables.length>0&&t.Tables[0].length>0&&!s.J0.IsEmpty(t.Tables[0][0].nextDate)&&(a.d.SessionManager.Preferences.ContainsKey("RentalNarrFormat")&&""!=a.d.SessionManager.Preferences.RentalNarrFormat?i+="-"+s.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString(a.d.SessionManager.Preferences.RentalNarrFormat):i+="-"+s.J0.ParseDate(t.Tables[0][0].nextDate.toString()).AddDays(-1).ToString("MMM/yyyy")),i+=")",i}LoadDocument(t,l,m=!0,i=0){var e=this;return(0,V.A)(function*(){let h,b=s.J0.String(t.VoucherNo);if(e.ClubInvoice)h=""!=t.DocumentDate.ToString()?s.J0.ParseDate(t.DocumentDate):new Date;else{if(s.J0.IsEmpty(t.EventTime))return;h=s.J0.ParseDate(t.EventTime.toString())}let O=parseInt(t.SchEventID.toString()),G="";Object.keys(t).Contains("SchGUID")&&(G=s.J0.String(t.SchGUID));let E=a.d.report.GetDocumentDetailsByVoucherNo(b);if(s.J0.Int(E.obj)>0){let T;T=E.Tables[0].length>0?E.Tables[0][0]:E.Tables[1][0];const{AddEditDocumentViewModel:J}=yield Promise.resolve().then(D.bind(D,32668)),{AddEditDocumentComponent:K}=yield Promise.resolve().then(D.bind(D,19214));let r=null;null!=e.oDocument&&null==e.oDocument.ScreenObject&&(e.oDocument=null),parseInt(t.SubCostCenterID)>0&&t.SubCostCenterID.toString()!=t.CostCenterID.toString()?((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(t.SubCostCenterID))&&(e.oDocument=new J(parseInt(t.SubCostCenterID.toString()),"",!!l)),r=e.oDocument.ScreenObject.GetEditDataByCCDOCID(t.CostCenterID.toString(),t.NodeID.toString())):((null==e.oDocument||e.oDocument.CostCenterID!=parseInt(T.CostCenterID))&&(e.oDocument=new J(parseInt(T.CostCenterID),T.DocumentName.toString(),!!l)),r=e.oDocument.ScreenObject.GetEditData(T.DocPrefix.toString(),T.DocNumber.toString(),0)),l||a.d.page.addNewTab({title:e.oDocument.ScreenName,component:K,params:{obj:e.oDocument}});let M="";null!=r&&r.Tables.length>0&&r.Tables[0].length>0&&r.Columns[0].Contains("VoucherNO")&&(M=r.Tables[0][0].VoucherNO.toString());let P,B=!1;"2"==s.J0.String(t.RecurMethod)&&!s.J0.IsEmpty(t.RecurMethod)&&"2"==s.J0.String(t.RecurMethod)&&(B=!0),e.ClubInvoice&&!e.oDocument.ScreenObject.GridDataColumns.Contains("ScheduleID")&&(e.oDocument.ScreenObject.GridDataColumns.push("ScheduleID"),e.oDocument.ScreenObject.GridDataColumns.push("SchGUID"));for(let o=0;o<r.Tables[0].length;o++)r.Tables[0][o].DocDetailsID="0",r.Tables[0][o].DocID="0",!s.J0.IsEmpty(t.AttachmentID)&&"0"==s.J0.String(t.AttachmentID)&&r.Columns[0].Contains("CanRecur")&&(r.Tables[0][o].CanRecur=null),B&&(P=r.Tables[0][o].CreditAccount,r.Tables[0][o].CreditAccount=r.Tables[0][o].DebitAccount,r.Tables[0][o].DebitAccount=P,P=r.Tables[0][o].CrAccountCode,r.Tables[0][o].CrAccountCode=r.Tables[0][o].DBAccountCode,r.Tables[0][o].DBAccountCode=P,P=r.Tables[0][o].CrAccountName,r.Tables[0][o].CrAccountName=r.Tables[0][o].DBAccountName,r.Tables[0][o].DBAccountName=P,P=r.Tables[0][o].CrIsBillWise,r.Tables[0][o].CrIsBillWise=r.Tables[0][o].DBIsBillWise,r.Tables[0][o].DBIsBillWise=P);for(let o=0;o<r.Tables[8].length;o++)r.Columns[8].Contains("CanEdit")&&(r.Tables[8][o].CanEdit=!0);if(r.Columns[0].Remove("DocDate"),r.Columns[0].Remove("DocNumber"),e.oDocument.ScreenObject.DocPrefix.ComboBox.SelectedValue=T.DocPrefix.toString(),e.oDocument._Ddate=h,e.oDocument.OnDocPrefixChanged_2(T.DocPrefix.toString(),!1),e.oDocument.ScreenObject.LoadEditData(r,!1,O),e.oDocument.ScheduleID=O,e.oDocument.RecurDocumentVoucherNo=M,e.oDocument.SchGUID=G,e.oDocument.objGeneralDashboard=e,r.Columns[0].Contains("RefCCID")&&"95"==r.Tables[0][0].RefCCID.toString()){r.Columns[0].Contains("RefNodeid")&&!s.J0.IsEmpty(r.Tables[0][0].RefNodeid)&&(e.oDocument.ScreenObject.RefNodeID=parseInt(r.Tables[0][0].RefNodeid.toString())),e.oDocument.ScreenObject.RefCCId=95;let o=null;if(a.d.SessionManager.Preferences.ContainsKey("DepositLinkDimension")&&!s.J0.IsEmpty(a.d.SessionManager.Preferences.DepositLinkDimension)&&(o=e.oDocument.ScreenObject.ColumnSource.find(u=>u.CostCenterID==parseInt(a.d.SessionManager.Preferences.DepositLinkDimension))),null==o)return void(e.oDocument=null);let n=e.oDocument.ScreenObject.GetScheduleDetails(e.oDocument.ScreenObject.RefNodeID,h,O),N=e.GetNarr(n,h,i);if(null!=(g=e.oDocument.ScreenObject._StaticFields.find(u=>"CommonNarration"==u.DBColumnName))&&g instanceof v.Dw&&0==i&&(g.Text=N),e.ClubInvoice){var L=e.oDocument.ScreenObject.GridData.filter(u=>u.ScheduleID==O);for(let u=0;u<L.length;u++)e.oDocument.ScreenObject.GridDataColumns.Contains("LineNarration")&&(L[u].LineNarration=N),L[u].SchGUID=G}if(null!=n&&n.Tables[0].length>0&&"1"==n.Tables[0][0].islastInv.toString()&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&!s.J0.IsEmpty(n.Tables[2][0].CCID)){if(null!=o&&e.oDocument.ScreenObject.GridDataColumns.Contains(o.ValueMember))for(let u=0;u<n.Tables[2].length;u++)if((c=e.oDocument.ScreenObject.GridData.filter(f=>f[o.ValueMember]==s.J0.String(n.Tables[2][u].CCNodeID))).length>0){let f=s.J0.Double(n.Tables[2][u].Amount);if((d=n.Tables[1].filter(C=>C.PartID==n.Tables[2][u].CCNodeID.toString())).length>0&&!s.J0.IsEmpty(d[0].TotInv)&&(f-=s.J0.Double(d[0].TotInv)),f<=0&&(f=0),1==c.length)c[0].Rate=f,c[0].Gross=f,e.oDocument.CalculateTotals(c[0],!1),f=s.J0.Double(n.Tables[2][u].VatAmount),d.length>0&&""!=s.J0.String(d[0].TotVat)&&(f-=s.J0.Double(d[0].TotVat)),f>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(C=>!s.J0.IsEmpty(C.DisplayMember)&&"dcnum53"==C.DisplayMember.toLowerCase()))&&(c[0].dcNum53=f.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=f.ToString("N"+I.DecimalPoints),e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=f.ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum61=f.ToString("N"+I.DecimalPoints)));else{let C=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[o.ValueMember]==n.Tables[2][u].CCNodeID).Compute("sum","Rate");var I;null!=y&&y.toString().length>0&&(C=f-s.J0.Double(y)),C>0&&!s.J0.IsEmpty(c[0].Rate)&&(c[0].Rate=s.J0.Double(c[0].Rate)+C,c[0].Gross=c[0].Rate,e.oDocument.CalculateTotals(c[0],!1)),f=s.J0.Double(n.Tables[2][u].VatAmount),d.length>0&&!s.J0.IsEmpty(d[0].TotVat)&&(f-=s.J0.Double(d[0].TotVat)),C=0,y=e.oDocument.ScreenObject.GridData.filter(S=>S[o.ValueMember]==n.Tables[2][u].CCNodeID).Compute("sum","dcNum53"),null!=y&&y.toString().length>0&&(C=f-s.J0.Double(y)),C>0&&null!=(I=e.oDocument.ScreenObject.ColumnSource.find(p=>!s.J0.IsEmpty(p.DisplayMember)&&"dcnum53"==p.DisplayMember.toLowerCase()))&&!s.J0.IsEmpty(c[0].dcNum53)&&(c[0].dcNum53=(s.J0.Double(c[0].dcNum53)+C).ToString("N"+I.DecimalPoints),c[0].dcCalcdcNum53=c[0].dcNum53,e.oDocument.ScreenObject.GridDataColumns.Contains("dcNum61")&&(c[0].dcNum61=c[0].dcNum53,c[0].dcCalcdcNum61=c[0].dcNum53))}}}else if(null!=n&&n.Tables[0].length>0&&n.Tables.length>2&&n.Columns[2].Contains("CCID")&&n.Tables[2].length>0&&""!=n.Tables[2][0].CCID.toString()&&null!=o&&e.oDocument.ScreenObject.GridDataColumns.Contains(o.ValueMember))for(let u=0;u<n.Tables[2].length;u++){var c;if((c=e.oDocument.ScreenObject.GridData.filter(C=>C[o.ValueMember]==n.Tables[2][u].CCNodeID.toString())).length>0){let C=parseFloat(n.Tables[2][u].Amount.toString());var d;if((d=n.Tables[1].filter(S=>S.PartID==n.Tables[2][u].CCNodeID.toString())).length>0&&!s.J0.IsEmpty(d[0].TotInv)&&(C-=parseFloat(d[0].TotInv.toString())),C<=0)for(let S=0;S<c.length;S++)c[S].Rate=0,c[S].Gross=0,e.oDocument.CalculateTotals(c[S],!1)}}}if(""!=M){let o=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&52627==n.LinkData);if(o.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(o[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)s.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][o[0].SysColumnName.toString()]=M);else for(let n=0;n<r.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][o[0].SysColumnName.toString()]=M;else(g=e.oDocument.ScreenObject._TextFields.find(N=>N.DBColumnName.toLowerCase()==o[0].SysColumnName.toString().toLowerCase()))&&g instanceof v.Dw&&(g.Text=M);if(o=e.oDocument.ScreenObject.Data.Tables[0].filter(n=>79==n.LocalReference&&55262==n.LinkData),o.length>0)if(e.oDocument.ScreenObject.GridDataColumns.Contains(o[0].SysColumnName.toString()))if(e.oDocument.IsInventoryVoucher)for(let n=0;n<e.oDocument.ScreenObject.GridData.length;n++)s.J0.IsEmpty(e.oDocument.ScreenObject.GridData[n].ProductID_Key)||(e.oDocument.ScreenObject.GridData[n][o[0].SysColumnName.toString()]="1");else for(let n=0;n<r.Tables[0].length;n++)e.oDocument.ScreenObject.GridData[n][o[0].SysColumnName.toString()]="1";else{var g;(g=e.oDocument.ScreenObject._TextFields.find(N=>N.DBColumnName.toLowerCase()==o[0].SysColumnName.toString().toLowerCase()))instanceof v.Dw&&(g.Text="1")}}e.oDocument.SetNewDocButtonVisibility(),l&&m&&(e.oDocument.GenratePrefix=!0,e.oDocument.ScreenObject.Preferences.ContainsKey("Alwaysnewreference")?e.oDocument.ScreenObject.Preferences.Alwaysnewreference="true":e.oDocument.ScreenObject.Preferences.push("Alwaysnewreference","true"),e.oDocument.SaveCallBackMethod.Subscribe(e,"DocSaveCallBack"),e.oDocument.IsInventoryVoucher?e.oDocument.SaveInventoryDocument_1("ReSave"):e.oDocument.SaveAccountingDocument("ReSave"),e.oDocument.callbacksubject.subscribe(o=>{e.dtColumns.Contains("Remarks")&&(t.Remarks=e.oDocument.DisplayMessage,t.Postedvoucherno=e.oDocument.ScreenObject.VoucherNo),e.dtGrid.RefreshGridView()}))}})()}DocSaveCallBack(){this.ProgressValue++,this.ProgressValue==this.ProgressMax&&(this.ShowProcessDialog=!1)}GetStr(t,l){let m;switch(m=s.J0.Int(t),m++,m+=l,m){case 1:return"1st ";case 2:return"2nd ";case 3:return"3rd ";default:return m+"th "}}}}}]);